import{_ as A,a0 as H,a1 as K,u as R,r as v,T,y as W,a as $,b as w,c as h,a2 as o,w as n,d as a,t as i,i as j,F as X,a3 as c,E as Y,bW as G,a4 as J,j as _,bX as L,ab as O,bY as Q,p as Z,k as ee}from"./index-6dffac25.js";import{E as se}from"./el-dialog-07b209e8.js";/* empty css                   */import{E as ae,a as le}from"./el-form-item-6ff780e0.js";/* empty css                 */import{E as oe,a as te}from"./el-progress-5b91453b.js";import"./castArray-de661912.js";import"./_initCloneObject-b01b6320.js";import"./isEqual-9c97ee0b.js";const g=m=>(Z("data-v-cbe94f6a"),m=m(),ee(),m),re={class:"icon mr8","aria-hidden":"true",style:{"font-size":"12px"}},ie=g(()=>a("use",{"xlink:href":"#icon-Back"},null,-1)),ne=[ie],de={class:"main"},ue={class:"second-title"},pe={class:"flex-between top"},_e={class:"flex-center"},me={class:"avatar"},ce={class:"icon","aria-hidden":"true",style:{"font-size":"10px"}},fe=g(()=>a("use",{"xlink:href":"#icon-camera"},null,-1)),ve=[fe],we={style:{"margin-bottom":"14px"}},he={class:"top-right"},ge={style:{"margin-top":"12px"}},be={class:"content"},ye={class:"flex-between item"},Pe={class:"label"},Ve={class:"flex-between item"},ke={class:"label"},$e={class:"flex-between item"},Ee={class:"label"},Ue={class:"flex-between item"},xe={class:"label"},Me={class:"footer"},Se={class:"between"},Ce=g(()=>a("div",null,null,-1)),Ie={__name:"Profile",setup(m){const{t:u,locale:Be}=H(),b=K(),y=R(),E=()=>{window.history.length>1?y.back():y.push("/")},U=v("https://52.83.27.237/api/web/upload_image/"),x=e=>{if(e.type.startsWith("image/")){if(e.size/1024/1024>2)return c.error("Picture size can not exceed 2MB!"),!1}else return c.error("Please select a picture!"),!1;return!0},M=(e,l)=>{e.image_url&&(s.value.avatar=e.image_url,P())},s=v({});T(()=>b.state.userInfo,(e,l)=>{s.value.first_name=e.first_name,s.value.last_name=e.last_name,s.value.affiliation=e.affiliation,s.value.github_url=e.github_url||"",s.value.google_scholar_url=e.google_scholar_url||"",s.value.linkedin_url=e.linkedin_url||"",s.value.avatar=e.avatar,s.value.username=e.username,s.value.email=e.email},{immediate:!0,deep:!0});const S=W(()=>{let e=2;return s.value.first_name&&(e+=1),s.value.last_name&&(e+=1),s.value.affiliation&&(e+=1),s.value.github_url&&(e+=1),Math.round(100*e/6)}),P=()=>{b.dispatch("updateUser",{first_name:s.value.first_name,last_name:s.value.last_name,affiliation:s.value.affiliation,github_url:s.value.github_url,google_scholar_url:s.value.google_scholar_url,linkedin_url:s.value.linkedin_url,avatar:s.value.avatar}).then(e=>{c.success(u("user.profileUpdatedSuccess"))})},t=$({visible:!1,old_password:"",new_password1:"",new_password2:""}),C=()=>{t.visible=!0},V=v(),k=()=>{V.value.validate(e=>{e&&Q({old_password:t.old_password,new_password1:t.new_password1,new_password2:t.new_password2}).then(l=>{c.success(u("user.pwChangeSuccess")),t.visible=!1})})},I=(e,l,d)=>{l!==t.new_password1?d(new Error(u("user.confirmpwVerify1"))):d()},B=$({old_password:[{required:!0,message:u("user.oldPwVerify1"),trigger:"blur"},{pattern:/^.{8,}$/,message:u("user.oldPwVerify2"),trigger:"blur"}],new_password1:[{required:!0,message:u("user.newPwVerify1"),trigger:"blur"},{pattern:/^.{8,}$/,message:u("user.oldPwVerify2"),trigger:"blur"}],new_password2:[{validator:I,trigger:"blur"}]});return(e,l)=>{const d=Y,F=G,z=oe,N=te,p=J,f=ae,D=le,q=se;return w(),h(X,null,[o(d,{text:"",onClick:E},{default:n(()=>[(w(),h("svg",re,ne)),_(" "+i(e.$t("back")),1)]),_:1}),a("div",de,[a("div",ue,i(e.$t("user.profile")),1),a("div",pe,[a("div",_e,[a("div",me,[o(F,{size:64,src:s.value.avatar||j(L)},null,8,["src"]),o(z,{class:"avatar-uploader",name:"image",action:U.value,"show-file-list":!1,"on-success":M,"before-upload":x},{default:n(()=>[(w(),h("svg",ce,ve))]),_:1},8,["action"])]),a("div",null,[a("div",we,i(s.value.username),1),a("div",null,i(s.value.email),1)])]),a("div",he,[o(N,{type:"circle",percentage:S.value,width:65,"stroke-width":7,color:"#6D87F9"},null,8,["percentage"]),a("div",ge,i(e.$t("user.profileCompleted")),1)])]),a("div",be,[a("div",ye,[a("div",Pe,i(e.$t("user.password")),1),o(d,{plain:"",onClick:C},{default:n(()=>[_(i(e.$t("user.changePassword")),1)]),_:1})]),a("div",Ve,[a("div",ke,i(e.$t("user.firstName")),1),o(p,{modelValue:s.value.first_name,"onUpdate:modelValue":l[0]||(l[0]=r=>s.value.first_name=r),modelModifiers:{trim:!0},placeholder:"-",maxlength:"150"},null,8,["modelValue"])]),a("div",$e,[a("div",Ee,i(e.$t("user.lastName")),1),o(p,{modelValue:s.value.last_name,"onUpdate:modelValue":l[1]||(l[1]=r=>s.value.last_name=r),modelModifiers:{trim:!0},placeholder:"-",maxlength:"150"},null,8,["modelValue"])]),a("div",Ue,[a("div",xe,i(e.$t("user.affiliatedTo")),1),o(p,{modelValue:s.value.affiliation,"onUpdate:modelValue":l[2]||(l[2]=r=>s.value.affiliation=r),modelModifiers:{trim:!0},placeholder:"-",maxlength:"512"},null,8,["modelValue"])])]),a("div",Me,[o(d,{type:"primary",onClick:P},{default:n(()=>[_(i(e.$t("save")),1)]),_:1})])]),o(q,{modelValue:t.visible,"onUpdate:modelValue":l[7]||(l[7]=r=>t.visible=r),title:e.$t("user.changePassword"),width:"500",class:"oa-dialog","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:n(()=>[a("div",Se,[Ce,a("div",null,[o(d,{onClick:l[6]||(l[6]=r=>t.visible=!1),text:"",bg:""},{default:n(()=>[_(i(e.$t("cancel")),1)]),_:1}),o(d,{type:"primary",onClick:k},{default:n(()=>[_(i(e.$t("submit")),1)]),_:1})])])]),default:n(()=>[o(D,{model:t,rules:B,ref_key:"passwordRef",ref:V,"label-position":"top","require-asterisk-position":"right"},{default:n(()=>[o(f,{label:e.$t("user.oldPassword"),prop:"old_password"},{default:n(()=>[o(p,{type:"password",modelValue:t.old_password,"onUpdate:modelValue":l[3]||(l[3]=r=>t.old_password=r),modelModifiers:{trim:!0},placeholder:e.$t("user.oldPasswordPH"),maxlength:"128","show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(f,{label:e.$t("user.newPassword"),prop:"new_password1"},{default:n(()=>[o(p,{type:"password",modelValue:t.new_password1,"onUpdate:modelValue":l[4]||(l[4]=r=>t.new_password1=r),modelModifiers:{trim:!0},placeholder:e.$t("user.newPasswordPH"),maxlength:"128","show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(f,{label:e.$t("user.confirmpw"),prop:"new_password2"},{default:n(()=>[o(p,{type:"password",modelValue:t.new_password2,"onUpdate:modelValue":l[5]||(l[5]=r=>t.new_password2=r),modelModifiers:{trim:!0},placeholder:e.$t("user.confirmpwPH"),maxlength:"128","show-password":"",onKeypress:O(k,["enter"])},null,8,["modelValue","placeholder","onKeypress"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])],64)}}},Te=A(Ie,[["__scopeId","data-v-cbe94f6a"]]);export{Te as default};
